<div class="nav">
    <div style="display:flex; gap:15px; align-items:center;">
        <a href="/index.html">â—€ Home</a>
        <a id="myProfileBtn" href="#" style="background:rgba(255,255,255,0.2); padding:4px 10px; border-radius:4px;">My Profile</a>
    </div>
    <b>AeroBook</b>
    <a href="/logout">Logout</a>
</div>

<script>
    async function initSocial() {
        // 1. Get the current logged-in user's name from the server
        // We use a dummy profile call to retrieve the 'myName' field from your server.js
        const userCheck = await fetch('/api/profile/check').catch(() => ({}));
        const userData = await userCheck.json();
        const myName = userData.myName;

        // 2. REDIRECTION FIX: Update the button link to point to profile.html
        if (myName) {
            document.getElementById('myProfileBtn').href = `/profile.html?user=${myName}`;
        }

        // 3. Load the feed as usual
        const posts = await fetch('/api/posts').then(r => r.json());
        renderFeed(posts, myName);
    }

    function renderFeed(posts, myName) {
        document.getElementById('feed').innerHTML = posts.map(p => `
            <div class="box">
                <div class="post-header">
                    <a href="/profile.html?user=${p.author}" style="color:#365899; font-weight:bold; text-decoration:none;">${p.author}</a>
                    ${p.author === myName ? `
                        <form action="/api/delete-post" method="POST">
                            <input type="hidden" name="postId" value="${p._id}">
                            <button type="submit" style="color:#999; border:none; background:none; cursor:pointer; font-size:11px;">Delete Post</button>
                        </form>` : ''}
                </div>
                <p>${p.content}</p>
                </div>
        `).join('');
    }

    initSocial();
</script>
